!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SingleWidgetManager=t():e.SingleWidgetManager=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SEARCH_REQUEST="SEARCH_REQUEST",e.SEARCH_FAILED="SEARCH_FAILED",e.COLLECT_POINT_SELECTED="COLLECT_POINT_SELECTED",e.COLLECT_POINT_UNSELECTED="COLLECT_POINT_UNSELECTED",e.COLLECT_POINT_CONFIRMED="COLLECT_POINT_CONFIRMED",e.BOOT_FAILED="BOOT_FAILED",e.WIDGET_READY="WIDGET_READY"}(t.SubscribeTopic||(t.SubscribeTopic={})),function(e){e.INVALIDATE_MAP_SIZE="INVALIDATE_MAP_SIZE",e.MAP_SEARCH_QUERY="MAP_SEARCH_QUERY",e.MAP_LATLNG_QUERY="MAP_LATLNG_QUERY",e.RESET_STATE="RESET_STATE",e.SHOW_STATIC_MAP="SHOW_STATIC_MAP",e.SHOW_INFORMATION="SHOW_INFORMATION",e.SET_CONFIGURATION="SET_CONFIGURATION",e.SET_CONFIGURATION_THEME="SET_CONFIGURATION_THEME"}(t.EmitTopic||(t.EmitTopic={}))},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=r(4),o=r(5),s=r(8),a=r(9),u=r(10),c=r(0),E=r(11),f=r(2),h=function(){function e(t){void 0===t&&(t={});var r=new o.default,h={container:document.body,iframeParams:{},iframeUrl:null,isDebug:!1,healthCheck:!0};if(void 0!==t.container&&!(t.container instanceof Element))throw Error(u.ERROR_MESSAGES.CONTAINER_NOT_ELEMENT);var l=n(n(n({},h),t),{iframeParams:n(n({},t.iframeParams),{managerVersion:e.meta.version})});if("string"!=typeof l.iframeUrl)throw Error(u.ERROR_MESSAGES.IFRAME_URL_REQUIRED);try{new URL(l.iframeUrl)}catch(e){throw Error(u.ERROR_MESSAGES.URL_PARSE_ERROR)}var _=new URL(l.iframeUrl),d=new s.default(l.iframeParams,_.origin,_.pathname).getIframeEl(),p=new i.default(r,d,_.origin,l.isDebug);if(l.healthCheck&&E.default.healthCheck(_.origin,l.isDebug,function(){var e;if("boolean"!=typeof l.healthCheck)return null===(e=null==l?void 0:l.healthCheck)||void 0===e?void 0:e.timeout}()).catch((function(e){l.isDebug&&console.error(u.ERROR_MESSAGES.HEALTH_CHECK_FAILED,e),p.abort(),p.eventManager.emit(c.SubscribeTopic.BOOT_FAILED,{error:f.BOOT_FAIL_CODES.HEALTH_CHECK_FAILED})})),!d)throw Error(u.ERROR_MESSAGES.IFRAME_NOT_FOUND);if(!l.container)throw Error(u.ERROR_MESSAGES.CONTAINER_NOT_FOUND);l.container.append(d);var O={events:n(n({},r.getConsumerMethods()),{emit:function(e,t){return p.queueMessageToIframe({topic:e,message:t}),this}}),topics:a.windowTopicsObject};this.events=O.events,this.topics=O.topics}return e.meta={commitHash:'ef67801',version:'2.5.5'},e.iframeUrls={SANDBOX:"https://sandbox.frame.hub-box.com",PRODUCTION:"https://frame.hub-box.com"},e}();t.SingleWidgetManager=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_MESSAGES={IFRAME_NOT_FOUND:"The Iframe cannot be found in the DOM",PROBLEM_PARSING_MESSAGE:"There was a problem parsing the message",INTERVAL_NOT_DEFINED:"Response Interval is not defined",EXCEEDED_MAX_HANDSHAKES:"Exceeded max number of handshake retries"},t.DEBUG_MESSAGES={TOPIC_NOT_FOUND:"The Topic sent in iframe message cannot be found"},t.BOOT_FAIL_CODES={EXCEEDED_MAX_HANDSHAKES:"EXCEEDED_MAX_HANDSHAKES",HEALTH_CHECK_FAILED:"HEALTH_CHECK_FAILED"},t.HANDSHAKE_MESSAGE="handshake",t.HANDSHAKE_REPLY_MESSAGE="handshake-reply"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.default=n.SingleWidgetManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),o=function(){function e(e,t,r,n){void 0===n&&(n=!1),this.eventManager=e,this.iframeEl=t,this.iframeOrigin=r,this.isDebug=n,this.eventManager=e,this.iframeEl=t,this.iframeOrigin=r,this.isDebug=n,this.channel=new MessageChannel,this.numOfHandshakeAttempts=0,this.maxNumOfHandshakeAttempts=5,this.intervalTime=500,this.messageQueue=[],this.handshakeReceived=!1,this.aborted=!1,this.setUpHandshakeOnLoad()}return e.prototype.sendHandshakeToIframeWindow=function(){if(!this.iframeEl||!this.iframeEl.contentWindow)throw Error(i.ERROR_MESSAGES.IFRAME_NOT_FOUND);try{this.setUpMessageListener(),this.iframeEl.contentWindow.postMessage(i.HANDSHAKE_MESSAGE,this.iframeOrigin,[this.channel.port2])}catch(e){this.isDebug&&console.warn("Post message failed. "+(this.maxNumOfHandshakeAttempts-this.numOfHandshakeAttempts)+" attempts left")}},e.prototype.abort=function(){this.aborted=!0},e.prototype.setUpMessageListener=function(){this.channel.port2.close(),this.channel.port1.close(),this.channel=new MessageChannel,this.channel.port1.onmessage=this.handShakeReplyCallback.bind(this)},e.prototype.queueMessageToIframe=function(e){this.handshakeReceived?this.channel.port1.postMessage(e):this.messageQueue.push(e)},e.prototype.performHandshake=function(){if(!this.responseInterval)throw Error(i.ERROR_MESSAGES.INTERVAL_NOT_DEFINED);if(this.numOfHandshakeAttempts>=this.maxNumOfHandshakeAttempts||this.aborted)return clearInterval(this.responseInterval),void(this.aborted||this.eventManager.emit(n.SubscribeTopic.BOOT_FAILED,{error:i.BOOT_FAIL_CODES.EXCEEDED_MAX_HANDSHAKES}));this.numOfHandshakeAttempts++,this.sendHandshakeToIframeWindow()},e.prototype.setUpHandshakeOnLoad=function(){var e=this;this.iframeEl.addEventListener("load",function(){e.responseInterval=setInterval(e.performHandshake.bind(e),e.intervalTime),e.performHandshake()}.bind(this))},e.prototype.handShakeReplyCallback=function(e){var t=this;if(e.data===i.HANDSHAKE_REPLY_MESSAGE){if(this.handshakeReceived=!0,!this.responseInterval)throw Error(i.ERROR_MESSAGES.INTERVAL_NOT_DEFINED);clearInterval(this.responseInterval),this.channel.port1.onmessage=this.messageCallback.bind(this),this.messageQueue.forEach((function(e){t.channel.port1.postMessage(e)}))}},e.prototype.messageCallback=function(e){var t=e.data;t.topic in n.SubscribeTopic?this.eventManager.emit(t.topic,t.message):this.isDebug&&console.debug(i.DEBUG_MESSAGES.TOPIC_NOT_FOUND)},e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(6),o=r(7),s=function(){function e(t){void 0===t&&(t=e.getEventTargetWithFallback()),this.target=t,this.subscribedEvents=Object.keys(n.SubscribeTopic).reduce((function(e,t){return e[t]=[],e}),{}),this.target=t}return e.prototype.subscribe=function(e,t,r){var o=this;if(void 0===r&&(r=!1),e in n.SubscribeTopic){var s=function(r){return t({topic:e,message:r.detail})};return this.target.addEventListener(e,s,{once:r}),this.subscribedEvents[e].push([t,function(){return o.target.removeEventListener(e,s)}]),this}throw Error(i.TOPIC_ERROR_MESSAGE)},e.prototype.unsubscribe=function(e,t){if(!(e in n.SubscribeTopic))throw Error(i.TOPIC_ERROR_MESSAGE);if(t){var r=this.subscribedEvents[e].find((function(e){return e[0]===t}));r&&r[1]&&r[1]()}else this.subscribedEvents[e].forEach((function(e){e&&e[1]&&e[1]()}));return this},e.prototype.takeFirst=function(e,t){if(e in n.SubscribeTopic)return this.subscribe(e,t,!0);throw Error(i.TOPIC_ERROR_MESSAGE)},e.prototype.emit=function(e,t){if(!(e in n.SubscribeTopic))throw Error(i.TOPIC_ERROR_MESSAGE);return this.target.dispatchEvent(new CustomEvent(e,{detail:t})),this},e.prototype.getConsumerMethods=function(){return o.consumerMethodsFactory(this)},e.getEventTargetWithFallback=function(){var e;try{e=new EventTarget}catch(t){e=document.createElement("div")}return e},e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TOPIC_ERROR_MESSAGE="Topic cannot be found"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.consumerMethodsFactory=function(e){return{subscribe:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.subscribe.apply(e,t),this},unsubscribe:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.unsubscribe.apply(e,t),this},takeFirst:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.takeFirst.apply(e,t),this}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){void 0===e&&(e={}),this.srcParameters=e,this.iframeOrigin=t,this.iframePath=r,this.iframeOrigin=t,this.srcParameters=e,this.iframeEl=document.createElement("iframe"),this.setIframeSrc(),this.setAllowGeoLocation(),this.setNoScrolling(),this.setNoFrameBorder()}return e.prototype.setIframeSrc=function(){this.hasKeys(this.srcParameters)?this.iframeEl.src=""+this.iframeOrigin+this.iframePath+"?"+this.serializeSrcParameters():this.iframeEl.src=this.iframeOrigin+this.iframePath},e.prototype.setAllowGeoLocation=function(){this.getIframeEl().setAttribute("allow","geolocation")},e.prototype.setNoScrolling=function(){this.getIframeEl().setAttribute("scrolling","no")},e.prototype.setNoFrameBorder=function(){this.getIframeEl().setAttribute("frameBorder","0")},e.prototype.getIframeEl=function(){return this.iframeEl},e.prototype.getIframeOrigin=function(){return this.iframeOrigin},e.prototype.serializeSrcParameters=function(){return e.serialise(this.srcParameters)},e.serialise=function(e){return Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return"object"==typeof e[t]?[t,JSON.stringify(e[t])].map(encodeURIComponent).join("="):[t,e[t]].map(encodeURIComponent).join("=")})).join("&")},e.prototype.hasKeys=function(e){return!!Object.keys(e).length},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.windowTopicsObject={subscribe:Object.keys(n.SubscribeTopic).reduce((function(e,t){return e[t]=t,e}),{}),emit:Object.keys(n.EmitTopic).reduce((function(e,t){return e[t]=t,e}),{})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_MESSAGES={CONTAINER_NOT_FOUND:"Could not find container in the DOM. Iframe could not be appended",IFRAME_NOT_FOUND:"Cannot find iframe element",CONTAINER_NOT_ELEMENT:"Container should to be a DOM element",URL_PARSE_ERROR:"Unable to parse iframe url",IFRAME_URL_REQUIRED:"Iframe url option is a required option",HEALTH_CHECK_FAILED:"Health check failed"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),i=r(12),o=function(){function e(){}return e.healthCheck=function(t,r,o){void 0===o&&(o=this.DEFAULT_TIMEOUT),Object.values(n.SingleWidgetManager.iframeUrls).includes(t)&&r&&console.warn(t+" is not in iframeUrls list, please use an iframe from SingleWidgetManager.iframeUrls");var s=new AbortController,a=window.setTimeout((function(){s.abort()}),o);return new Promise((function(r,n){return fetch(t+"/"+e.URL_SLUG,{signal:s.signal}).then((function(e){if(200!==e.status)throw Error(i.ERROR_MESSAGES.HEALTH_CHECK_STATUS);return e.json()})).then((function(t){if(t.status!==e.UP_STATUS)throw Error(i.ERROR_MESSAGES.HEALTH_CHECK_BODY);r()})).catch((function(e){n(e)})).finally((function(){clearTimeout(a)}))}))},e.URL_SLUG="health",e.UP_STATUS="UP",e.DEFAULT_TIMEOUT=5e3,e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_MESSAGES={HEALTH_CHECK_STATUS:"Health Check response does not have status code of 200",HEALTH_CHECK_BODY:"Health Check response body is not valid"}}]).default}));